<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pompe √† essence automatis√©e ‚Ä¢ Gr√©goire Desparain</title>
  <style>
    :root {
      --bg-grad-1: #0f172a;
      --bg-grad-2: #1e293b;
      --card-bg: #1e2537;
      --text-main: #f8fafc;
      --text-dim: #94a3b8;
      --accent: #38bdf8;
      --radius-xl: 1.25rem;
      --mono: "Courier New", monospace;
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      padding: 0;
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", Roboto, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at 20% 20%, var(--bg-grad-2) 0%, var(--bg-grad-1) 60%);
      color: var(--text-main);
      line-height: 1.5;
      padding: 2rem 1rem 4rem;
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }

    header {
      margin-bottom: 2.5rem;
      position: relative;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      row-gap: 1rem;
      align-items: flex-start;
    }

    .left-buttons {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .nav-btn {
      text-decoration: none;
      color: var(--accent);
      font-size: .9rem;
      font-weight: 500;
      background: rgba(56,189,248,.08);
      border: 1px solid rgba(56,189,248,.4);
      border-radius: var(--radius-xl);
      padding: .5rem .75rem;
      line-height: 1.2;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      box-shadow: 0 20px 40px rgba(56,189,248,.15);
      transition: all .15s linear;
    }

    .nav-btn:hover {
      background: rgba(56,189,248,.15);
      transform: translateY(-1px) scale(1.01);
    }

    .mini-meta {
      text-align: right;
      color: var(--text-dim);
      font-size: .8rem;
      line-height: 1.3;
    }

    .mini-meta .role {
      color: var(--accent);
      font-weight: 500;
      font-size: .8rem;
    }

    h1 {
      color: var(--text-main);
      font-size: clamp(1.6rem, 1vw, 2rem);
      font-weight: 600;
      letter-spacing: -0.04em;
      line-height: 1.2;
      margin: 1.5rem 0 .5rem;
      display: flex;
      align-items: baseline;
      gap: .5rem;
      flex-wrap: wrap;
    }

    .pill {
      font-size: .7rem;
      font-weight: 500;
      background: rgba(148,163,184,.12);
      border: 1px solid rgba(148,163,184,.3);
      color: var(--text-dim);
      padding: .3rem .5rem;
      border-radius: var(--radius-xl);
      line-height: 1.1;
    }

    .subtitle {
      color: var(--text-dim);
      font-size: 1rem;
      max-width: 650px;
      line-height: 1.4;
    }

    section.block {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(148,163,184,.15);
      box-shadow: 0 30px 80px rgba(0,0,0,.6);
      padding: 1.25rem 1.25rem 1rem;
      margin-bottom: 1.25rem;
    }

    .block h2 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: .6rem;
      display: flex;
      align-items: baseline;
      gap: .5rem;
      flex-wrap: wrap;
    }

    .block p {
      font-size: .9rem;
      color: var(--text-dim);
      margin-bottom: .8rem;
      line-height: 1.5;
    }

    ul.details-list {
      list-style: none;
      padding-left: 0;
    }

    ul.details-list li {
      margin-bottom: .5rem;
      display: flex;
      align-items: flex-start;
      gap: .5rem;
      font-size: .9rem;
      color: var(--text-dim);
      line-height: 1.4;
    }

    ul.details-list li .bullet {
      width: .5rem;
      height: .5rem;
      border-radius: 50%;
      background: var(--accent);
      margin-top: .45rem;
      box-shadow: 0 0 10px rgba(56,189,248,.8);
      flex-shrink: 0;
    }

    pre {
      background: rgba(15,23,42,.5);
      color: #e2e8f0;
      border: 1px solid rgba(56,189,248,.3);
      border-radius: var(--radius-xl);
      padding: 1rem;
      overflow-x: auto;
      font-family: var(--mono);
      font-size: .8rem;
      line-height: 1.4;
      margin-bottom: 1rem;
      box-shadow: 0 0 40px rgba(56,189,248,.15);
      white-space: pre;
    }

    code {
      font-family: var(--mono);
    }

    footer {
      text-align: center;
      color: var(--text-dim);
      font-size: .75rem;
      margin-top: 3rem;
      line-height: 1.4;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    @media (max-width: 480px) {
      .top-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .mini-meta {
        text-align: left;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="top-row">
    <div class="left-buttons">
      <a class="nav-btn" href="/" title="Retour au portfolio">‚Üê Retour au portfolio</a>
      <a class="nav-btn" href="https://github.com/gregdespa/arduino-gas-pump" target="_blank" rel="noopener noreferrer">
        üß© Voir le d√©p√¥t GitHub
      </a>
    </div>

    <div class="mini-meta">
      <div class="role">R√¥le : Syst√®mes embarqu√©s / Arduino</div>
      <div>Tech : Clavier, LCD, capteurs, boucle temps r√©el</div>
      <div>2024‚Äì2025</div>
    </div>
  </div>

  <h1>
    Pompe √† essence automatis√©e
    <span class="pill">Arduino / Contr√¥le embarqu√©</span>
  </h1>

  <p class="subtitle">
    Syst√®me embarqu√© qui simule une borne de station-service en libre-service.
    Il g√®re la validation de la carte avec code PIN, le verrouillage de nuit,
    la d√©tection du pistolet, le d√©bit de carburant en temps r√©el, le calcul du prix
    et l‚Äôimpression d‚Äôun re√ßu sur l‚Äô√©cran LCD. L‚Äôobjectif est de reproduire
    le parcours complet d‚Äôun client √† la pompe automatique.
  </p>
</header>

<section class="block">
  <h2>01. Parcours utilisateur <span class="pill">Comment on fait le plein</span></h2>
  <ul class="details-list">
    <li>
      <span class="bullet"></span>
      <span><strong>V√©rification d‚Äôouverture :</strong> Un capteur de luminosit√© est lu. Si c‚Äôest ‚Äúla nuit‚Äù, l‚Äô√©cran affiche ¬´ Closed Station ¬ª en boucle et la pompe est bloqu√©e.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Insertion de la carte :</strong> Un capteur sur l‚Äôentr√©e 12 d√©tecte si une carte est pr√©sente. Tant que la carte n‚Äôest pas ins√©r√©e, la borne attend.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Saisie du code PIN :</strong> L‚Äôutilisateur tape un code √† 4 chiffres sur un clavier matriciel 4x3. L‚Äô√©cran affiche les chiffres tap√©s mais masque progressivement les pr√©c√©dents avec ¬´ * ¬ª. Apr√®s 3 erreurs, la carte est bloqu√©e.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Retirer la carte :</strong> Par s√©curit√©, le plein ne peut pas d√©marrer tant que la carte est encore d√©tect√©e. On doit retirer la carte avant d‚Äôacc√©der au carburant.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Prendre le pistolet :</strong> Une entr√©e num√©rique (pin 10) simule ¬´ pistolet d√©croch√© ¬ª. L‚Äô√©cran affiche ¬´ Veuillez prendre le pistolet‚Ä¶ ¬ª tant qu‚Äôil est encore raccroch√©.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Appuyer pour distribuer :</strong> Tant que le pistolet est en main ET que le bouton pompe est maintenu appuy√©, l‚Äôessence ‚Äúcoule‚Äù. Chaque seconde ajoute +2 L et met √† jour en direct le volume servi et le prix total en euros.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Raccrocher le pistolet :</strong> Quand l‚Äôutilisateur remet le pistolet sur son support, la borne affiche un r√©capitulatif final (litres + prix), puis ¬´ √Ä Bient√¥t ! ¬ª.</span>
    </li>
  </ul>
</section>

<section class="block">
  <h2>02. S√©curit√© & r√©alisme <span class="pill">Comportement r√©el d‚Äôune pompe</span></h2>
  <ul class="details-list">
    <li>
      <span class="bullet"></span>
      <span><strong>Verrouillage de nuit :</strong> La pompe reste ferm√©e si la luminosit√© ambiante est trop basse. C‚Äôest une simulation d‚Äôhoraires d‚Äôouverture.</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span><strong>Anti-fraude PIN :</strong> Code PIN sur 4 chiffres (¬´ 7358 ¬ª). Apr√®s 3 essais √©chou√©s, la carte est refus√©e et marqu√©e bloqu√©e (<code>kill = 1</code>).</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span><strong>Obligation de retirer la carte :</strong> Le client doit retirer physiquement la carte avant de pouvoir se servir, comme sur les pompes CB en libre-service.</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span><strong>D√©tection du pistolet :</strong> On ne peut pas pomper tant que le pistolet n‚Äôest pas d√©croch√©, et il faut le raccrocher pour obtenir le ticket final.</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span><strong>Prix en direct :</strong> Le prix est recalcul√© en temps r√©el en fonction du volume r√©ellement distribu√© et du tarif <code>P_SP22 = 4.30 ‚Ç¨/L</code>.</span>
    </li>
  </ul>
</section>

<section class="block">
  <h2>03. Mat√©riel & entr√©es/sorties <span class="pill">√âlectronique</span></h2>
  <ul class="details-list">
    <li>
      <span class="bullet"></span>
      <span><strong>Clavier matriciel 4x3</strong> c√¢bl√© sur les broches num√©riques 22‚Äì28 pour la saisie du code PIN.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>√âcran LCD 16x2</strong> sur les broches (8, 9, 2, 3, 5, 6) ‚Äî affiche les instructions, les litres, le montant √† payer.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Capteur de luminosit√©</strong> sur <code>A1</code> ‚Äî permet de d√©terminer si la station est ‚Äúouverte‚Äù.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>D√©tection carte</strong> sur la broche 12 ‚Äî indique si une carte est ins√©r√©e ou retir√©e.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>D√©tection pistolet</strong> sur la broche 10 ‚Äî indique si le pistolet de carburant est d√©croch√© / raccroch√©.</span>
    </li>

    <li>
      <span class="bullet"></span>
      <span><strong>Bouton pompe</strong> sur la broche 4 ‚Äî simule la poign√©e qu‚Äôon maintient pour faire couler le carburant.</span>
    </li>
  </ul>
</section>

<section class="block">
  <h2>04. Logique principale <span class="pill">Boucle temps r√©el Arduino</span></h2>
  <p>
    Ci-dessous un extrait simplifi√© de la boucle de distribution :
    toutes les 1000 ms pendant que l‚Äôutilisateur maintient la poign√©e,
    on ajoute +2 L, on met √† jour le prix total, et on affiche les infos √† l‚Äô√©cran.
    Le plein est plafonn√© √† 45 L pour simuler la capacit√© du r√©servoir.
  </p>

  <pre><code class="language-c">
// prix au litre
float P_SP22 = 4.30;

// plein = niveau actuel
// LPT   = niveau initial (al√©atoire 0..60 L)
// prix  = co√ªt actuel en ‚Ç¨

if (LPT <= 40 && kill != 1) {
    lcd.clear();
    lcd.print("Veuillez prendre");
    lcd.setCursor(0,1);
    lcd.print("le pistolet...");

    // attendre que le pistolet soit pris
    while (digitalRead(10) == 0);

    lcd.clear();
    lcd.print("Appuyez pour demarrer");

    // tant que le pistolet est tenu
    while (digitalRead(10) == 1) {
        // si la gachette est appuyee
        if (digitalRead(4) == 1) {
            int debut_appui = millis();
            while (digitalRead(4) == 1 && plein < 45) {
                if (millis() - debut_appui >= 1000) {
                    plein += 2; // +2 L/s
                    prix = (plein - LPT) * P_SP22;

                    lcd.clear();
                    lcd.setCursor(0,0);
                    lcd.print(plein);
                    lcd.setCursor(10,0);
                    lcd.print(prix);
                    lcd.print("‚Ç¨");

                    debut_appui = millis();
                }
            }
            stop = 1;
        }
    }
}
  </code></pre>

  <p>
    √Ä la fin, la pompe exige que le pistolet soit raccroch√©.
    Ensuite l‚Äô√©cran affiche le volume servi (en litres) et le prix final en euros,
    puis un message de fin : ¬´ A Bientot ! ¬ª.
  </p>
</section>

<section class="block">
  <h2>05. Ce que j‚Äôai appris <span class="pill">Comp√©tences</span></h2>
  <ul class="details-list">
    <li>
      <span class="bullet"></span>
      <span>S√©curisation d‚Äôune interface argent / paiement : carte, code PIN, blocage apr√®s 3 essais.</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span>Conception en machine d‚Äô√©tats : ¬´ carte ins√©r√©e ‚Üí authentification ‚Üí carte retir√©e ‚Üí pistolet d√©croch√© ‚Üí appui sur la poign√©e ‚Üí remplissage ‚Üí pistolet raccroch√© ‚Üí re√ßu ¬ª.</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span>Boucles temps r√©el sans <code>delay()</code> avec <code>millis()</code>, pour garder l‚Äôinterface r√©active pendant que le remplissage √©volue.</span>
    </li>
    <li>
      <span class="bullet"></span>
      <span>Interaction homme-machine : messages clairs sur l‚Äô√©cran LCD √† chaque √©tape, comme sur une vraie pompe 24/7 CB.</span>
    </li>
  </ul>
</section>

<footer>
  <p>
    R√©alis√© par Gr√©goire Desparain ‚Äî IMT Nord Europe (Mines de Douai)<br/>
    <a href="/">‚Üê Retour au portfolio</a>
  </p>
</footer>

</body>
</html>
